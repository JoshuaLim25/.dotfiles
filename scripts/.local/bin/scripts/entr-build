#!/usr/bin/env bash

set -euo pipefail
IFS=$'\n\t'

# src:https://jvns.ca/blog/2020/06/28/entr/#restart-every-time-a-new-file-is-added-entr-d
# using `gorun` alias for the time being

usage() { echo "Usage: $(basename "$0") <build_script>" >&2; }

if [[ "$#" -ne 2 ]]; then
    usage
    exit 42
fi

build_script="$1"

if [[ -z $build_script ]]; then
    usage
    exit 42
fi

while true; do
{ git ls-files; git ls-files . --exclude-standard --others; } | entr -d "$build_script"
done

